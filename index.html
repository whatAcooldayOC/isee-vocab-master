<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ISEE Vocab Master</title>
    <style>
        :root {
            --primary: #6366f1; /* More vibrant indigo */
            --bg: #0f172a;      /* Darker slate */
            --card-bg: #1e293b;
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
        }

        body {
            font-size: 18px; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Navigation */
        .nav {
            display: flex;
            justify-content: space-around;
            background-color: var(--card-bg);
            padding: 15px 0; 
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom, 15px);
        }

        .nav-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .nav-btn span {
            font-size: 1.5rem; 
        }

        .nav-btn.active {
            color: var(--primary);
            font-weight: 800;
            transform: scale(1.1); 
            transition: transform 0.2s;
        }

        /* Content Area */
        .container {
            flex: 1;
            padding: 25px;
            padding-bottom: 160px; 
            overflow-y: auto;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            padding-top: 40px;
        }

        /* Views */
        .view {
            display: none;
            animation: zoomIn 0.3s ease-out;
            width: 100%;
        }
        .view.active {
            display: block;
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 24px; 
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-new { background: rgba(99, 102, 241, 0.2); color: var(--primary); }
        .status-learning { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .status-mastered { background: rgba(16, 185, 129, 0.2); color: var(--success); }

        .word-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .word-title {
            font-size: 3.2rem; 
            font-weight: 800;
            margin: 0;
            color: var(--primary);
            letter-spacing: -1px;
        }

        .speak-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: background 0.2s;
        }
        .speak-btn:active {
            background: var(--primary);
        }

        .part-speech {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 25px;
            display: block;
            font-weight: 500;
        }

        .definition {
            font-size: 1.5rem; 
            line-height: 1.6;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .synonym-box {
            background-color: rgba(99, 102, 241, 0.15); 
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
        }

        .synonym-label {
            font-size: 0.9rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .synonym-list {
            font-size: 1.3rem;
            font-weight: 600;
        }

        /* SRS Buttons Container */
        .srs-actions {
            position: fixed;
            bottom: 100px;
            left: 25px;
            right: 25px;
            max-width: 550px;
            margin: 0 auto;
            z-index: 90;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .srs-btn {
            border: none;
            padding: 20px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.5);
            transition: transform 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .srs-btn:active { transform: scale(0.95); }

        .btn-hard {
            background-color: var(--card-bg);
            border: 2px solid var(--error);
            color: var(--error);
        }
        
        .btn-easy {
            background-color: var(--success);
            color: white;
        }

        /* Quiz Styles */
        .quiz-question {
            font-size: 1.6rem;
            line-height: 1.5;
            margin-bottom: 30px;
            font-weight: 500;
        }

        .options-grid {
            display: grid;
            gap: 16px;
        }

        .option-btn {
            background-color: var(--card-bg);
            border: 3px solid rgba(255,255,255,0.1); 
            color: var(--text);
            padding: 20px;
            border-radius: 16px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            position: relative;
            overflow: hidden;
        }

        .option-btn:active {
            transform: scale(0.96);
            border-color: var(--text-secondary);
        }

        .option-btn.correct {
            border-color: var(--success);
            background-color: rgba(16, 185, 129, 0.2);
            color: #6EE7B7;
        }

        .option-btn.wrong {
            border-color: var(--error);
            background-color: rgba(239, 68, 68, 0.2);
            opacity: 0.6;
        }

        .next-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 800;
            position: fixed;
            bottom: 100px;
            left: 25px;
            right: 25px;
            width: auto;
            max-width: 550px;
            margin: 0 auto;
            z-index: 90;
            cursor: pointer;
            display: none;
            box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.5);
        }

        /* Progress Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .header h2 {
            font-size: 1.8rem;
            margin: 0;
            font-weight: 800;
        }

        .streak {
            font-size: 1.4rem;
            color: #FCD34D;
            font-weight: bold;
            background: rgba(252, 211, 77, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* Settings Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 24px;
            width: 100%;
            max-width: 400px;
        }
        .settings-row { margin-bottom: 20px; }
        .settings-label { display: block; margin-bottom: 10px; font-weight: bold; color: var(--text-secondary); }
        select, input[type=range] {
            width: 100%; padding: 15px; border-radius: 12px;
            background: var(--bg); border: 1px solid var(--text-secondary);
            color: var(--text); font-size: 1.1rem;
        }
        .close-modal {
            background: var(--primary); color: white; border: none; padding: 15px;
            width: 100%; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
        }

    </style>
</head>
<body>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <h2 style="margin-top:0">Settings</h2>
            <div class="settings-row">
                <label class="settings-label">Voice</label>
                <select id="voice-select" onchange="previewVoice()"><option value="">Default</option></select>
            </div>
            <div class="settings-row">
                <label class="settings-label">Speed: <span id="rate-val">0.9</span>x</label>
                <input type="range" id="rate-range" min="0.5" max="1.5" step="0.1" value="0.9" oninput="updateRateLabel()" onchange="previewVoice()">
            </div>
            <div class="settings-row">
                <button class="nav-btn" style="width:100%; border: 1px solid var(--error); color: var(--error); border-radius: 12px; padding: 10px;" onclick="resetProgress()">‚ö†Ô∏è Reset Progress</button>
            </div>
            <button class="close-modal" onclick="toggleSettings()">Done</button>
        </div>
    </div>

    <div class="container">
        <!-- LEARN MODE -->
        <div id="view-learn" class="view active">
            <div class="header">
                <h2>Daily Words</h2>
                <button class="nav-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
            </div>
            <div id="flashcard-container"></div>
            
            <!-- SRS Buttons -->
            <div class="srs-actions">
                <button class="srs-btn btn-hard" onclick="handleSRS('hard')">
                    <span>‚ùå Hard</span>
                    <span style="font-size:0.8rem; font-weight:400; opacity:0.8">Review soon</span>
                </button>
                <button class="srs-btn btn-easy" onclick="handleSRS('easy')">
                    <span>‚úÖ Easy</span>
                    <span style="font-size:0.8rem; font-weight:400; opacity:0.8">Master it</span>
                </button>
            </div>
        </div>

        <!-- SYNONYM QUIZ -->
        <div id="view-synonym" class="view">
            <div class="header">
                <h2>Synonym Match</h2>
                <span class="streak">üî• <span id="syn-streak">0</span></span>
            </div>
            <div class="card">
                <p class="part-speech" style="margin-bottom:10px">Select the best synonym for:</p>
                <div class="word-header" style="margin-bottom:0">
                    <h1 class="word-title" id="quiz-word">...</h1>
                    <button class="speak-btn" onclick="speakText(document.getElementById('quiz-word').innerText)">üîä</button>
                </div>
            </div>
            <div class="options-grid" id="syn-options"></div>
            <button class="next-btn" id="syn-next-btn" onclick="nextSynonymQuiz()">Next Question ‚ûî</button>
        </div>

        <!-- SENTENCE QUIZ -->
        <div id="view-sentence" class="view">
            <div class="header">
                <h2>Completion</h2>
                <span class="streak">üî• <span id="sen-streak">0</span></span>
            </div>
            <div class="card">
                <p class="quiz-question" id="sen-question">...</p>
                <button class="speak-btn" style="margin: 0 auto" onclick="speakText(document.getElementById('sen-question').innerText)">üîä Listen</button>
            </div>
            <div class="options-grid" id="sen-options"></div>
            <button class="next-btn" id="sen-next-btn" onclick="nextSentenceQuiz()">Next Question ‚ûî</button>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="switchView('learn', this)"><span>üìö</span>Learn</button>
        <button class="nav-btn" onclick="switchView('synonym', this)"><span>üîó</span>Quiz 1</button>
        <button class="nav-btn" onclick="switchView('sentence', this)"><span>üìù</span>Quiz 2</button>
        <button class="nav-btn" onclick="toggleSettings()"><span>‚öôÔ∏è</span>Settings</button>
    </nav>

    <script>
        // --- DATA (Truncated for brevity in edit, full list assumed) ---
        const iseeVocabulary = [
          { word: "Abandon", partOfSpeech: "v.", definition: "To leave behind; to give up.", synonyms: ["Desert", "Forsake", "Relinquish", "Leave"], sentence: "The sailors had to ______ the sinking ship.", correctAnswer: "abandon", level: "Middle" },
          { word: "Abundant", partOfSpeech: "adj.", definition: "Existing or available in large quantities; plentiful.", synonyms: ["Plentiful", "Copious", "Ample", "Profuse"], sentence: "The garden had an ______ supply of tomatoes this summer.", correctAnswer: "abundant", level: "Middle" },
          { word: "Accumulate", partOfSpeech: "v.", definition: "To gather together or acquire an increasing number or quantity of.", synonyms: ["Gather", "Collect", "Amass", "Compile"], sentence: "Dust began to ______ on the old books.", correctAnswer: "accumulate", level: "Middle" },
          { word: "Adapt", partOfSpeech: "v.", definition: "To make suitable for a new use or purpose.", synonyms: ["Adjust", "Modify", "Acclimate", "Alter"], sentence: "Animals must ______ to their changing environments to survive.", correctAnswer: "adapt", level: "Middle" },
          { word: "Adept", partOfSpeech: "adj.", definition: "Very skilled or proficient at something.", synonyms: ["Skilled", "Expert", "Proficient", "Talented"], sentence: "She is ______ at playing the piano.", correctAnswer: "adept", level: "Middle" },
          { word: "Adhere", partOfSpeech: "v.", definition: "To stick fast to a surface or substance.", synonyms: ["Stick", "Cling", "Attach", "Hold"], sentence: "The glue will help the poster ______ to the wall.", correctAnswer: "adhere", level: "Middle" },
          { word: "Agony", partOfSpeech: "n.", definition: "Extreme physical or mental suffering.", synonyms: ["Pain", "Torment", "Anguish", "Misery"], sentence: "He collapsed in ______ after breaking his leg.", correctAnswer: "agony", level: "Middle" },
          { word: "Allegiance", partOfSpeech: "n.", definition: "Loyalty or commitment of a subordinate to a superior or of an individual to a group or cause.", synonyms: ["Loyalty", "Fidelity", "Devotion", "Dedication"], sentence: "The knights swore ______ to the king.", correctAnswer: "allegiance", level: "Middle" },
          { word: "Ambition", partOfSpeech: "n.", definition: "A strong desire to do or to achieve something.", synonyms: ["Aspiration", "Goal", "Desire", "Drive"], sentence: "Her ______ was to become a famous scientist.", correctAnswer: "ambition", level: "Middle" },
          { word: "Ample", partOfSpeech: "adj.", definition: "Enough or more than enough; plentiful.", synonyms: ["Sufficient", "Plentiful", "Abundant", "Enough"], sentence: "There was ______ room in the car for everyone.", correctAnswer: "ample", level: "Middle" },
          { word: "Anguish", partOfSpeech: "n.", definition: "Severe mental or physical pain or suffering.", synonyms: ["Agony", "Torment", "Pain", "Distress"], sentence: "She cried in ______ when she heard the bad news.", correctAnswer: "anguish", level: "Middle" },
          { word: "Anticipate", partOfSpeech: "v.", definition: "To regard as probable; expect or predict.", synonyms: ["Expect", "Predict", "Foresee", "Await"], sentence: "We ______ that the trip will take three hours.", correctAnswer: "anticipate", level: "Middle" },
          { word: "Anxious", partOfSpeech: "adj.", definition: "Experiencing worry, unease, or nervousness.", synonyms: ["Worried", "Nervous", "Uneasy", "Apprehensive"], sentence: "He felt ______ about the upcoming exam.", correctAnswer: "anxious", level: "Middle" },
          { word: "Apparel", partOfSpeech: "n.", definition: "Clothing.", synonyms: ["Clothing", "Attire", "Garments", "Dress"], sentence: "The store sells men's and women's ______.", correctAnswer: "apparel", level: "Middle" },
          { word: "Appeal", partOfSpeech: "v.", definition: "To make a serious or urgent request.", synonyms: ["Plead", "Request", "Implore", "Ask"], sentence: "The charity made an ______ for donations.", correctAnswer: "appeal", level: "Middle" },
          { word: "Apprehensive", partOfSpeech: "adj.", definition: "Anxious or fearful that something bad or unpleasant will happen.", synonyms: ["Anxious", "Fearful", "Worried", "Uneasy"], sentence: "She was ______ about walking home alone at night.", correctAnswer: "apprehensive", level: "Middle" },
          { word: "Arid", partOfSpeech: "adj.", definition: "Having little or no rain; too dry or barren to support vegetation.", synonyms: ["Dry", "Parched", "Barren", "Waterless"], sentence: "The ______ desert landscape had very few plants.", correctAnswer: "arid", level: "Middle" },
          { word: "Arrogant", partOfSpeech: "adj.", definition: "Having or revealing an exaggerated sense of one's own importance or abilities.", synonyms: ["Haughty", "Conceited", "Proud", "Egotistical"], sentence: "His ______ attitude made him unpopular with his classmates.", correctAnswer: "arrogant", level: "Middle" },
          { word: "Awe", partOfSpeech: "n.", definition: "A feeling of reverential respect mixed with fear or wonder.", synonyms: ["Wonder", "Admiration", "Respect", "Amazement"], sentence: "We gazed at the mountains in ______.", correctAnswer: "awe", level: "Middle" },
          { word: "Barren", partOfSpeech: "adj.", definition: "Too poor to produce much or any vegetation.", synonyms: ["Unproductive", "Infertile", "Desolate", "Empty"], sentence: "The ______ land could not support any crops.", correctAnswer: "barren", level: "Middle" },
          { word: "Beacon", partOfSpeech: "n.", definition: "A fire or light set up in a high or prominent position as a warning, signal, or celebration.", synonyms: ["Signal", "Light", "Guide", "Warning"], sentence: "The lighthouse served as a ______ for ships.", correctAnswer: "beacon", level: "Middle" },
          { word: "Beneficial", partOfSpeech: "adj.", definition: "Favorable or advantageous; resulting in good.", synonyms: ["Helpful", "Useful", "Advantageous", "Good"], sentence: "Exercise is ______ to your health.", correctAnswer: "beneficial", level: "Middle" },
          { word: "Blunder", partOfSpeech: "n.", definition: "A stupid or careless mistake.", synonyms: ["Mistake", "Error", "Gaffe", "Slip"], sentence: "Forgetting the tickets was a major ______.", correctAnswer: "blunder", level: "Middle" },
          { word: "Boisterous", partOfSpeech: "adj.", definition: "Noisy, energetic, and cheerful; rowdy.", synonyms: ["Noisy", "Lively", "Rowdy", "Unruly"], sentence: "The ______ crowd cheered loudly at the game.", correctAnswer: "boisterous", level: "Middle" },
          { word: "Boycott", partOfSpeech: "v.", definition: "To withdraw from commercial or social relations with (a country, organization, or person) as a punishment or protest.", synonyms: ["Avoid", "Shun", "Reject", "Ban"], sentence: "People decided to ______ the company due to its unfair labor practices.", correctAnswer: "boycott", level: "Middle" },
          { word: "Burden", partOfSpeech: "n.", definition: "A load, especially a heavy one.", synonyms: ["Load", "Weight", "Strain", "Encumbrance"], sentence: "The heavy backpack was a ______ to carry.", correctAnswer: "burden", level: "Middle" },
          { word: "Campaign", partOfSpeech: "n.", definition: "A series of military or political operations intended to achieve a particular goal.", synonyms: ["Operation", "Movement", "Drive", "Crusade"], sentence: "The presidential ______ lasted for months.", correctAnswer: "campaign", level: "Middle" },
          { word: "Capacity", partOfSpeech: "n.", definition: "The maximum amount that something can contain.", synonyms: ["Volume", "Size", "Space", "Extent"], sentence: "The stadium was filled to ______.", correctAnswer: "capacity", level: "Middle" },
          { word: "Capital", partOfSpeech: "n.", definition: "The most important city or town of a country or region, usually its seat of government.", synonyms: ["Center", "Headquarters", "Seat", "Metropolis"], sentence: "Paris is the ______ of France.", correctAnswer: "capital", level: "Middle" },
          { word: "Chronological", partOfSpeech: "adj.", definition: "Arranged in the order of time.", synonyms: ["Sequential", "Consecutive", "Ordered", "Historical"], sentence: "The history book listed events in ______ order.", correctAnswer: "chronological", level: "Middle" },
          { word: "Civic", partOfSpeech: "adj.", definition: "Relating to a city or town, especially its administration; municipal.", synonyms: ["Municipal", "Public", "Urban", "Community"], sentence: "Voting is a ______ duty.", correctAnswer: "civic", level: "Middle" },
          { word: "Clarity", partOfSpeech: "n.", definition: "The quality of being coherent and intelligible.", synonyms: ["Clearness", "Lucidity", "Precision", "Simplicity"], sentence: "She explained the problem with great ______.", correctAnswer: "clarity", level: "Middle" },
          { word: "Collaborate", partOfSpeech: "v.", definition: "To work jointly on an activity, especially to produce or create something.", synonyms: ["Cooperate", "Team up", "Join forces", "Partner"], sentence: "The two artists decided to ______ on a mural.", correctAnswer: "collaborate", level: "Middle" },
          { word: "Collide", partOfSpeech: "v.", definition: "To hit with force when moving.", synonyms: ["Crash", "Smash", "Bump", "Strike"], sentence: "The two cars ______ at the intersection.", correctAnswer: "collide", level: "Middle" },
          { word: "Commend", partOfSpeech: "v.", definition: "To praise formally or officially.", synonyms: ["Praise", "Applaud", "Compliment", "Acclaim"], sentence: "The teacher ______ the student for her hard work.", correctAnswer: "commend", level: "Middle" },
          { word: "Commentary", partOfSpeech: "n.", definition: "An expression of opinions or offering of explanations about an event or situation.", synonyms: ["Explanation", "Analysis", "Review", "Critique"], sentence: "The sports ______ added excitement to the game.", correctAnswer: "commentary", level: "Middle" },
          { word: "Compact", partOfSpeech: "adj.", definition: "Closely and neatly packed together; dense.", synonyms: ["Small", "Compressed", "Dense", "Concise"], sentence: "The ______ car was easy to park in small spaces.", correctAnswer: "compact", level: "Middle" },
          { word: "Composure", partOfSpeech: "n.", definition: "The state or feeling of being calm and in control of oneself.", synonyms: ["Calmness", "Self-control", "Poise", "Serenity"], sentence: "She maintained her ______ despite the chaotic situation.", correctAnswer: "composure", level: "Middle" },
          { word: "Concise", partOfSpeech: "adj.", definition: "Giving a lot of information clearly and in a few words; brief but comprehensive.", synonyms: ["Brief", "Short", "Succinct", "Terse"], sentence: "Please keep your answers ______ and to the point.", correctAnswer: "concise", level: "Middle" },
          { word: "Consent", partOfSpeech: "n.", definition: "Permission for something to happen or agreement to do something.", synonyms: ["Permission", "Agreement", "Approval", "Assent"], sentence: "You need your parents' ______ to go on the field trip.", correctAnswer: "consent", level: "Middle" },
          { word: "Consequence", partOfSpeech: "n.", definition: "A result or effect of an action or condition.", synonyms: ["Result", "Effect", "Outcome", "Repercussion"], sentence: "Every action has a ______.", correctAnswer: "consequence", level: "Middle" },
          { word: "Conserve", partOfSpeech: "v.", definition: "To protect (something, especially an environmentally or culturally important place or thing) from harm or destruction.", synonyms: ["Protect", "Save", "Preserve", "Maintain"], sentence: "We must ______ water during the drought.", correctAnswer: "conserve", level: "Middle" },
          { word: "Conspicuous", partOfSpeech: "adj.", definition: "Standing out so as to be clearly visible.", synonyms: ["Noticeable", "Obvious", "Prominent", "Visible"], sentence: "The red hat made him ______ in the crowd.", correctAnswer: "conspicuous", level: "Middle" },
          { word: "Constant", partOfSpeech: "adj.", definition: "Occurring continuously over a period of time.", synonyms: ["Continuous", "Steady", "Persistent", "Unchanging"], sentence: "The ______ noise from the construction site was annoying.", correctAnswer: "constant", level: "Middle" },
          { word: "Contaminate", partOfSpeech: "v.", definition: "To make (something) impure by exposure to or addition of a poisonous or polluting substance.", synonyms: ["Pollute", "Taint", "Infect", "Poison"], sentence: "Chemicals can ______ the drinking water.", correctAnswer: "contaminate", level: "Middle" },
          { word: "Context", partOfSpeech: "n.", definition: "The circumstances that form the setting for an event, statement, or idea.", synonyms: ["Circumstances", "Setting", "Background", "Situation"], sentence: "It's important to understand the ______ of the quote.", correctAnswer: "context", level: "Middle" },
          { word: "Continuous", partOfSpeech: "adj.", definition: "Forming an unbroken whole; without interruption.", synonyms: ["Unbroken", "Uninterrupted", "Constant", "Nonstop"], sentence: "The rain was ______ for three days.", correctAnswer: "continuous", level: "Middle" },
          { word: "Controversy", partOfSpeech: "n.", definition: "Disagreement, typically when prolonged, public, and heated.", synonyms: ["Dispute", "Debate", "Argument", "Conflict"], sentence: "The new law caused a lot of ______.", correctAnswer: "controversy", level: "Middle" },
          { word: "Convenient", partOfSpeech: "adj.", definition: "Fitting in well with a person's needs, activities, and plans.", synonyms: ["Handy", "Useful", "Suitable", "Helpful"], sentence: "It is very ______ to have a grocery store nearby.", correctAnswer: "convenient", level: "Middle" },
          { word: "Cope", partOfSpeech: "v.", definition: "To deal effectively with something difficult.", synonyms: ["Manage", "Survive", "Handle", "Deal"], sentence: "She learned to ______ with the stress of her new job.", correctAnswer: "cope", level: "Middle" },
          { word: "Cordial", partOfSpeech: "adj.", definition: "Warm and friendly.", synonyms: ["Friendly", "Warm", "Genial", "Affable"], sentence: "The host gave us a ______ greeting.", correctAnswer: "cordial", level: "Middle" },
          { word: "Cultivate", partOfSpeech: "v.", definition: "To prepare and use (land) for crops or gardening.", synonyms: ["Grow", "Farm", "Plant", "Develop"], sentence: "Farmers ______ the land to grow food.", correctAnswer: "cultivate", level: "Middle" },
          { word: "Cumulative", partOfSpeech: "adj.", definition: "Increasing or increased in quantity, degree, or force by successive additions.", synonyms: ["Increasing", "Accumulated", "Growing", "Aggregate"], sentence: "The ______ effect of the snow caused the roof to collapse.", correctAnswer: "cumulative", level: "Middle" },
          { word: "Declare", partOfSpeech: "v.", definition: "To say something in a solemn and emphatic manner.", synonyms: ["Announce", "Proclaim", "State", "Assert"], sentence: "The country decided to ______ independence.", correctAnswer: "declare", level: "Middle" },
          { word: "Delicacy", partOfSpeech: "n.", definition: "A rare or expensive food item.", synonyms: ["Treat", "Luxury", "Specialty", "Tidbit"], sentence: "Caviar is considered a ______.", correctAnswer: "delicacy", level: "Middle" },
          { word: "Dense", partOfSpeech: "adj.", definition: "Closely compacted in substance.", synonyms: ["Thick", "Heavy", "Solid", "Packed"], sentence: "The forest was so ______ that sunlight couldn't reach the ground.", correctAnswer: "dense", level: "Middle" },
          { word: "Deplete", partOfSpeech: "v.", definition: "To use up the supply or resources of.", synonyms: ["Exhaust", "Drain", "Use up", "Consume"], sentence: "We must be careful not to ______ our natural resources.", correctAnswer: "deplete", level: "Middle" },
          { word: "Deposit", partOfSpeech: "v.", definition: "To put or set down (something or someone) in a specific place.", synonyms: ["Place", "Put", "Drop", "Lay"], sentence: "She went to the bank to ______ her paycheck.", correctAnswer: "deposit", level: "Middle" },
          { word: "Designate", partOfSpeech: "v.", definition: "To appoint (someone) to a specified position.", synonyms: ["Appoint", "Nominate", "Select", "Name"], sentence: "The teacher will ______ a leader for the group.", correctAnswer: "designate", level: "Middle" },
          { word: "Desperate", partOfSpeech: "adj.", definition: "Feeling, showing, or involving a hopeless sense that a situation is so bad as to be impossible to deal with.", synonyms: ["Hopeless", "Frantic", "Urgent", "Dire"], sentence: "The stranded hikers were ______ for water.", correctAnswer: "desperate", level: "Middle" },
          { word: "Deteriorate", partOfSpeech: "v.", definition: "To become progressively worse.", synonyms: ["Worsen", "Decline", "Decay", "Degrade"], sentence: "The weather began to ______ rapidly.", correctAnswer: "deteriorate", level: "Middle" },
          { word: "Dialogue", partOfSpeech: "n.", definition: "Conversation between two or more people.", synonyms: ["Conversation", "Talk", "Discussion", "Chat"], sentence: "The play featured witty ______ between the characters.", correctAnswer: "dialogue", level: "Middle" },
          { word: "Diligent", partOfSpeech: "adj.", definition: "Having or showing care and conscientiousness in one's work.", synonyms: ["Hardworking", "Industrious", "Assiduous", "Careful"], sentence: "The ______ student finished all her homework early.", correctAnswer: "diligent", level: "Middle" },
          { word: "Diminish", partOfSpeech: "v.", definition: "To make or become less.", synonyms: ["Decrease", "Reduce", "Lessen", "Decline"], sentence: "The pain began to ______ after taking the medicine.", correctAnswer: "diminish", level: "Middle" },
          { word: "Discretion", partOfSpeech: "n.", definition: "The quality of behaving or speaking in such a way as to avoid causing offense or revealing private information.", synonyms: ["Caution", "Prudence", "Judgment", "Tact"], sentence: "Viewer ______ is advised due to violence in the movie.", correctAnswer: "discretion", level: "Middle" },
          { word: "Dissent", partOfSpeech: "v.", definition: "To hold or express opinions that are at variance with those previously, commonly, or officially held.", synonyms: ["Disagree", "Object", "Differ", "Protest"], sentence: "Two judges ______ from the majority opinion.", correctAnswer: "dissent", level: "Middle" },
          { word: "Dissolve", partOfSpeech: "v.", definition: "To become incorporated into a liquid so as to form a solution.", synonyms: ["Melt", "Liquefy", "Disappear", "Fade"], sentence: "Sugar will ______ in hot tea.", correctAnswer: "dissolve", level: "Middle" },
          { word: "Distinct", partOfSpeech: "adj.", definition: "Recognizably different in nature from something else of a similar type.", synonyms: ["Different", "Separate", "Clear", "Noticeable"], sentence: "There are two ______ types of frogs in this pond.", correctAnswer: "distinct", level: "Middle" },
          { word: "Diversity", partOfSpeech: "n.", definition: "A range of different things.", synonyms: ["Variety", "Assortment", "Range", "Mixture"], sentence: "The city is known for its cultural ______.", correctAnswer: "diversity", level: "Middle" },
          { word: "Domestic", partOfSpeech: "adj.", definition: "Relating to the running of a home or to family relations.", synonyms: ["Household", "Family", "Home", "Internal"], sentence: "Cats and dogs are common ______ animals.", correctAnswer: "domestic", level: "Middle" },
          { word: "Dominate", partOfSpeech: "v.", definition: "To have a commanding influence on; exercise control over.", synonyms: ["Control", "Rule", "Govern", "Command"], sentence: "The tall buildings ______ the skyline.", correctAnswer: "dominate", level: "Middle" },
          { word: "Drastic", partOfSpeech: "adj.", definition: "Likely to have a strong or far-reaching effect; radical and extreme.", synonyms: ["Extreme", "Severe", "Radical", "Harsh"], sentence: "______ measures were needed to save the company.", correctAnswer: "drastic", level: "Middle" },
          { word: "Duration", partOfSpeech: "n.", definition: "The time during which something continues.", synonyms: ["Length", "Time", "Period", "Span"], sentence: "You must remain seated for the ______ of the flight.", correctAnswer: "duration", level: "Middle" },
          { word: "Dwell", partOfSpeech: "v.", definition: "To live in or at a specified place.", synonyms: ["Live", "Reside", "Inhabit", "Stay"], sentence: "Early humans used to ______ in caves.", correctAnswer: "dwell", level: "Middle" },
          { word: "Economy", partOfSpeech: "n.", definition: "The wealth and resources of a country or region.", synonyms: ["Wealth", "Finance", "System", "Market"], sentence: "Tourism is good for the local ______.", correctAnswer: "economy", level: "Middle" },
          { word: "Eerie", partOfSpeech: "adj.", definition: "Strange and frightening.", synonyms: ["Spooky", "Creepy", "Scary", "Weird"], sentence: "An ______ silence fell over the haunted house.", correctAnswer: "eerie", level: "Middle" },
          { word: "Effect", partOfSpeech: "n.", definition: "A change that is a result or consequence of an action or other cause.", synonyms: ["Result", "Outcome", "Consequence", "Impact"], sentence: "The medicine had an immediate ______ on her headache.", correctAnswer: "effect", level: "Middle" },
          { word: "Efficient", partOfSpeech: "adj.", definition: "Achieving maximum productivity with minimum wasted effort or expense.", synonyms: ["Productive", "Effective", "Organized", "Competent"], sentence: "Fuel-______ cars save money on gas.", correctAnswer: "efficient", level: "Middle" },
          { word: "Elaborate", partOfSpeech: "adj.", definition: "Involving many carefully arranged parts or details; detailed and complicated in design and planning.", synonyms: ["Detailed", "Complex", "Intricate", "Complicated"], sentence: "She made an ______ plan for the surprise party.", correctAnswer: "elaborate", level: "Middle" },
          { word: "Eligible", partOfSpeech: "adj.", definition: "Having the right to do or obtain something; satisfying the appropriate conditions.", synonyms: ["Qualified", "Entitled", "Allowed", "Suitable"], sentence: "You must be 18 to be ______ to vote.", correctAnswer: "eligible", level: "Middle" },
          { word: "Elude", partOfSpeech: "v.", definition: "To evade or escape from (a danger, enemy, or pursuer), typically in a skillful or cunning way.", synonyms: ["Evade", "Escape", "Avoid", "Dodge"], sentence: "The thief managed to ______ the police.", correctAnswer: "elude", level: "Middle" },
          { word: "Encounter", partOfSpeech: "v.", definition: "To unexpectedly experience or be faced with (something difficult or hostile).", synonyms: ["Face", "Meet", "Experience", "Confront"], sentence: "Hikers may ______ bears in these woods.", correctAnswer: "encounter", level: "Middle" },
          { word: "Equivalent", partOfSpeech: "adj.", definition: "Equal in value, amount, function, meaning, etc.", synonyms: ["Equal", "Identical", "Same", "Comparable"], sentence: "One dollar is ______ to four quarters.", correctAnswer: "equivalent", level: "Middle" },
          { word: "Erupt", partOfSpeech: "v.", definition: "To become active and eject lava, ash, and gases.", synonyms: ["Explode", "Burst", "Blow up", "Break out"], sentence: "The volcano could ______ at any moment.", correctAnswer: "erupt", level: "Middle" },
          { word: "Esteem", partOfSpeech: "n.", definition: "Respect and admiration, typically for a person.", synonyms: ["Respect", "Admiration", "Honor", "Regard"], sentence: "He is held in high ______ by his colleagues.", correctAnswer: "esteem", level: "Middle" },
          { word: "Exaggerate", partOfSpeech: "v.", definition: "To represent (something) as being larger, greater, better, or worse than it really is.", synonyms: ["Overstate", "Embellish", "Magnify", "Inflate"], sentence: "Don't ______; just tell us exactly what happened.", correctAnswer: "exaggerate", level: "Middle" },
          { word: "Excel", partOfSpeech: "v.", definition: "To be exceptionally good at or proficient in an activity or subject.", synonyms: ["Shine", "Stand out", "Succeed", "Surpass"], sentence: "She strives to ______ in her studies.", correctAnswer: "excel", level: "Middle" },
          { word: "Exclude", partOfSpeech: "v.", definition: "To deny (someone) access to or bar (someone) from a place, group, or privilege.", synonyms: ["Keep out", "Ban", "Bar", "Omit"], sentence: "They decided to ______ him from the team.", correctAnswer: "exclude", level: "Middle" },
          { word: "Expanse", partOfSpeech: "n.", definition: "An area of something, typically land or sea, presenting a wide continuous surface.", synonyms: ["Area", "Stretch", "Sweep", "Tract"], sentence: "We looked out over the vast ______ of the ocean.", correctAnswer: "expanse", level: "Middle" },
          { word: "Exploit", partOfSpeech: "v.", definition: "To make full use of and derive benefit from (a resource).", synonyms: ["Utilize", "Use", "Harness", "Take advantage of"], sentence: "Companies should not ______ their workers.", correctAnswer: "exploit", level: "Middle" },
          { word: "Extinct", partOfSpeech: "adj.", definition: "Having no living members.", synonyms: ["Dead", "Vanished", "Gone", "Defunct"], sentence: "Dinosaurs became ______ millions of years ago.", correctAnswer: "extinct", level: "Middle" },
          { word: "Extract", partOfSpeech: "v.", definition: "To remove or take out, especially by effort or force.", synonyms: ["Remove", "Pull out", "Take out", "Withdraw"], sentence: "The dentist had to ______ the tooth.", correctAnswer: "extract", level: "Middle" },
          { word: "Factor", partOfSpeech: "n.", definition: "A circumstance, fact, or influence that contributes to a result or outcome.", synonyms: ["Element", "Component", "Part", "Aspect"], sentence: "Price was a major ______ in our decision.", correctAnswer: "factor", level: "Middle" },
          { word: "Former", partOfSpeech: "adj.", definition: "Having previously filled a particular role or been a particular thing.", synonyms: ["Previous", "Past", "Prior", "Ex-"], sentence: "The ______ president gave a speech.", correctAnswer: "former", level: "Middle" },
          { word: "Formulate", partOfSpeech: "v.", definition: "To create or devise methodically (a strategy or a proposal).", synonyms: ["Devise", "Create", "Develop", "Plan"], sentence: "We need to ______ a plan to solve this problem.", correctAnswer: "formulate", level: "Middle" },
          { word: "Fuse", partOfSpeech: "v.", definition: "To join or blend to form a single entity.", synonyms: ["Combine", "Merge", "Blend", "Join"], sentence: "Heat can ______ metal parts together.", correctAnswer: "fuse", level: "Middle" },
          { word: "Futile", partOfSpeech: "adj.", definition: "Incapable of producing any useful result; pointless.", synonyms: ["Useless", "Pointless", "Fruitless", "Vain"], sentence: "It is ______ to argue with him when he is angry.", correctAnswer: "futile", level: "Middle" },
          { word: "Generate", partOfSpeech: "v.", definition: "To cause (something, especially an emotion or situation) to arise or come about.", synonyms: ["Create", "Produce", "Cause", "Make"], sentence: "Wind turbines ______ electricity.", correctAnswer: "generate", level: "Middle" },
          { word: "Genre", partOfSpeech: "n.", definition: "A category of artistic composition, as in music or literature, characterized by similarities in form, style, or subject matter.", synonyms: ["Category", "Type", "Style", "Class"], sentence: "Science fiction is my favorite literary ______.", correctAnswer: "genre", level: "Middle" },
          { word: "Habitat", partOfSpeech: "n.", definition: "The natural home or environment of an animal, plant, or other organism.", synonyms: ["Home", "Environment", "Territory", "Surroundings"], sentence: "The forest is the natural ______ of the deer.", correctAnswer: "habitat", level: "Middle" },
          { word: "Hazardous", partOfSpeech: "adj.", definition: "Risky; dangerous.", synonyms: ["Dangerous", "Risky", "Unsafe", "Perilous"], sentence: "Chemicals can be ______ to your health.", correctAnswer: "hazardous", level: "Middle" },
          { word: "Hoax", partOfSpeech: "n.", definition: "A humorous or malicious deception.", synonyms: ["Trick", "Prank", "Deception", "Fraud"], sentence: "The bomb threat turned out to be a ______.", correctAnswer: "hoax", level: "Middle" },
          { word: "Hostile", partOfSpeech: "adj.", definition: "Unfriendly; antagonistic.", synonyms: ["Unfriendly", "Aggressive", "Antagonistic", "Unkind"], sentence: "The enemy forces were ______.", correctAnswer: "hostile", level: "Middle" },
          { word: "Idiom", partOfSpeech: "n.", definition: "A group of words established by usage as having a meaning not deducible from those of the individual words.", synonyms: ["Expression", "Phrase", "Saying", "Figure of speech"], sentence: "\"Raining cats and dogs\" is a common English ______.", correctAnswer: "idiom", level: "Middle" },
          { word: "Ignite", partOfSpeech: "v.", definition: "To catch fire or cause to catch fire.", synonyms: ["Light", "Kindle", "Spark", "Burn"], sentence: "One match can ______ a whole forest.", correctAnswer: "ignite", level: "Middle" },
          { word: "Immense", partOfSpeech: "adj.", definition: "Extremely large or great, especially in scale or degree.", synonyms: ["Huge", "Enormous", "Vast", "Massive"], sentence: "The elephant is an ______ animal.", correctAnswer: "immense", level: "Middle" },
          { word: "Improvise", partOfSpeech: "v.", definition: "To create and perform (music, drama, or verse) spontaneously or without preparation.", synonyms: ["Invent", "Ad-lib", "Extemporize", "Make up"], sentence: "The actor had to ______ when he forgot his lines.", correctAnswer: "improvise", level: "Middle" },
          { word: "Inept", partOfSpeech: "adj.", definition: "Having or showing no skill; clumsy.", synonyms: ["Incompetent", "Unskilled", "Clumsy", "Awkward"], sentence: "He was ______ at fixing cars and made the problem worse.", correctAnswer: "inept", level: "Middle" },
          { word: "Inevitable", partOfSpeech: "adj.", definition: "Certain to happen; unavoidable.", synonyms: ["Unavoidable", "Certain", "Inescapable", "Sure"], sentence: "Change is ______ in life.", correctAnswer: "inevitable", level: "Middle" },
          { word: "Influence", partOfSpeech: "n.", definition: "The capacity to have an effect on the character, development, or behavior of someone or something.", synonyms: ["Effect", "Impact", "Power", "Control"], sentence: "Parents have a strong ______ on their children.", correctAnswer: "influence", level: "Middle" },
          { word: "Ingenious", partOfSpeech: "adj.", definition: "Clover, original, and inventive.", synonyms: ["Clever", "Inventive", "Creative", "Brilliant"], sentence: "It was an ______ solution to the problem.", correctAnswer: "ingenious", level: "Middle" },
          { word: "Innovation", partOfSpeech: "n.", definition: "The action or process of innovating.", synonyms: ["Change", "Invention", "Improvement", "Novelty"], sentence: "Technological ______ has changed how we live.", correctAnswer: "innovation", level: "Middle" }
        ];

        // --- PROGRESS MANAGER (SRS Logic) ---
        class ProgressManager {
            constructor() {
                this.storageKey = 'isee_vocab_progress_v1';
                this.progress = this.load();
            }

            load() {
                const stored = localStorage.getItem(this.storageKey);
                return stored ? JSON.parse(stored) : {};
            }

            save() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.progress));
            }

            // Status: 'new' | 'learning' | 'mastered'
            getWordStatus(word) {
                if (!this.progress[word]) return 'new';
                return this.progress[word].status;
            }

            updateWord(word, result) {
                // result: 'hard' (or wrong quiz) | 'easy' (or correct quiz)
                if (!this.progress[word]) {
                    this.progress[word] = { status: 'new', streak: 0, nextReview: 0 };
                }

                const entry = this.progress[word];
                const now = Date.now();

                if (result === 'hard') {
                    entry.status = 'learning';
                    entry.streak = 0;
                    entry.nextReview = now + (5 * 60 * 1000); // 5 mins
                } else if (result === 'easy') {
                    entry.streak += 1;
                    entry.status = 'mastered';
                    
                    // Simple exponential backoff: 1 day * 2^streak
                    // But maxing at 14 days for this simple app
                    const days = Math.min(Math.pow(2, entry.streak - 1), 14);
                    entry.nextReview = now + (days * 24 * 60 * 60 * 1000);
                }

                this.save();
                return entry;
            }

            getNextWord() {
                const now = Date.now();
                
                // 1. Find candidates (Learning > New > Mastered due)
                const candidates = iseeVocabulary.map(item => {
                    const prog = this.progress[item.word] || { status: 'new', nextReview: 0 };
                    let weight = 0;

                    if (prog.status === 'learning') weight = 100;
                    else if (prog.status === 'new') weight = 20;
                    else if (prog.status === 'mastered' && now >= prog.nextReview) weight = 50; // Due review
                    else weight = 0; // Not due

                    return { item, weight };
                }).filter(c => c.weight > 0);

                // If no candidates (all mastered and not due), pick a random mastered one just for practice (low weight)
                if (candidates.length === 0) {
                    const fallback = iseeVocabulary[Math.floor(Math.random() * iseeVocabulary.length)];
                    return fallback;
                }

                // Weighted random selection
                const totalWeight = candidates.reduce((sum, c) => sum + c.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const candidate of candidates) {
                    random -= candidate.weight;
                    if (random <= 0) return candidate.item;
                }
                
                return candidates[0].item;
            }
            
            reset() {
                if(confirm("Reset all learning progress?")) {
                    this.progress = {};
                    this.save();
                    location.reload();
                }
            }
        }

        const pm = new ProgressManager();

        // State
        let currentWordObj = null;
        let streak = 0;
        let currentQuizCorrect = "";

        // Global functions
        window.switchView = function(viewName, btnElement) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');

            if(viewName === 'synonym') nextSynonymQuiz();
            if(viewName === 'sentence') nextSentenceQuiz();
        };

        // --- SETTINGS ---
        window.toggleSettings = function() {
            const modal = document.getElementById('settings-modal');
            const isActive = modal.classList.contains('active');
            if (!isActive) { populateVoiceList(); modal.classList.add('active'); }
            else { modal.classList.remove('active'); }
        }
        window.resetProgress = () => pm.reset();
        window.updateRateLabel = function() { document.getElementById('rate-val').innerText = document.getElementById('rate-range').value; }
        function populateVoiceList() {
            const select = document.getElementById('voice-select');
            select.innerHTML = '<option value="">Default System Voice</option>';
            const voices = window.speechSynthesis.getVoices();
            voices.forEach((voice) => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                select.appendChild(option);
            });
        }

        // --- TTS ---
        window.speakText = function(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = document.getElementById('rate-range').value;
            const selectedVoiceName = document.getElementById('voice-select').value;
            if(selectedVoiceName) {
                const voices = window.speechSynthesis.getVoices();
                const foundVoice = voices.find(v => v.name === selectedVoiceName);
                if(foundVoice) utterance.voice = foundVoice;
            } else { utterance.lang = 'en-US'; }
            window.speechSynthesis.speak(utterance);
        }
        window.previewVoice = function() { speakText("Hello, this is a voice test."); }
        window.speechSynthesis.onvoiceschanged = populateVoiceList;

        // --- LEARN LOGIC ---
        window.renderFlashcard = function() {
            const word = pm.getNextWord();
            currentWordObj = word;
            
            const status = pm.getWordStatus(word.word);
            const statusClass = `status-${status}`;
            
            const container = document.getElementById('flashcard-container');
            container.innerHTML = `
                <div class="card" style="border-color: ${status === 'learning' ? 'var(--warning)' : 'transparent'}">
                    <div class="status-badge ${statusClass}">${status}</div>
                    <div class="word-header">
                        <h1 class="word-title">${word.word}</h1>
                        <button class="speak-btn" onclick="speakText('${word.word}')">üîä</button>
                    </div>
                    <span class="part-speech">${word.partOfSpeech} ‚Ä¢ ${word.level} ISEE</span>
                    <p class="definition">${word.definition}</p>
                    <div class="synonym-box">
                        <span class="synonym-label">ISEE Synonyms</span>
                        <div class="synonym-list">${word.synonyms.join(', ')}</div>
                    </div>
                </div>
            `;
        }
        
        window.handleSRS = function(result) {
            if(!currentWordObj) return;
            pm.updateWord(currentWordObj.word, result);
            renderFlashcard(); // Next
        }

        // --- UTILS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function getRandomDistractors(correctWordObj, count) {
            return iseeVocabulary.filter(w => w.word !== correctWordObj.word).sort(() => 0.5 - Math.random()).slice(0, count);
        }

        // --- QUIZZES ---
        window.nextSynonymQuiz = function() {
            document.getElementById('syn-next-btn').style.display = 'none';
            // Quiz also uses weighted random!
            const target = pm.getNextWord();
            currentWordObj = target;
            const correctSynonym = target.synonyms[0]; 
            currentQuizCorrect = correctSynonym;

            document.getElementById('quiz-word').innerText = target.word;
            const others = getRandomDistractors(target, 3);
            const options = [correctSynonym, ...others.map(w => w.synonyms[0])];
            renderOptions('syn-options', shuffleArray(options), checkSynonymAnswer);
        }

        function checkSynonymAnswer(selected, btn) {
            const btns = document.getElementById('syn-options').getElementsByClassName('option-btn');
            for(let b of btns) b.disabled = true;

            if (selected === currentQuizCorrect) {
                btn.classList.add('correct');
                streak++;
                document.getElementById('syn-streak').innerText = streak;
                speakText("Correct!");
                pm.updateWord(currentWordObj.word, 'easy'); // Mark as learned
            } else {
                btn.classList.add('wrong');
                for(let b of btns) if(b.innerText === currentQuizCorrect) b.classList.add('correct');
                streak = 0;
                document.getElementById('syn-streak').innerText = streak;
                pm.updateWord(currentWordObj.word, 'hard'); // Mark as hard/learning
            }
            document.getElementById('syn-next-btn').style.display = 'block';
        }

        window.nextSentenceQuiz = function() {
            document.getElementById('sen-next-btn').style.display = 'none';
            const target = pm.getNextWord();
            currentWordObj = target;
            currentQuizCorrect = target.word;

            document.getElementById('sen-question').innerText = target.sentence;
            const others = getRandomDistractors(target, 3);
            const options = [target.word, ...others.map(w => w.word)];
            renderOptions('sen-options', shuffleArray(options), checkSentenceAnswer);
        }

        function checkSentenceAnswer(selected, btn) {
            const btns = document.getElementById('sen-options').getElementsByClassName('option-btn');
            for(let b of btns) b.disabled = true;

            if (selected.toLowerCase() === currentQuizCorrect.toLowerCase()) {
                btn.classList.add('correct');
                streak++;
                document.getElementById('sen-streak').innerText = streak;
                speakText("Correct!");
                pm.updateWord(currentWordObj.word, 'easy');
            } else {
                btn.classList.add('wrong');
                for(let b of btns) if(b.innerText.toLowerCase() === currentQuizCorrect.toLowerCase()) b.classList.add('correct');
                streak = 0;
                document.getElementById('sen-streak').innerText = streak;
                pm.updateWord(currentWordObj.word, 'hard');
            }
            document.getElementById('sen-next-btn').style.display = 'block';
        }

        function renderOptions(containerId, options, callback) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => callback(opt, btn);
                container.appendChild(btn);
            });
        }

        // Init
        renderFlashcard();
    </script>
</body>
</html>
